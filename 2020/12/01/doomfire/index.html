<!doctype html>
<html lang="en" class="h-full antialiased light">
 <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="webmention" href="https://webmention.io/henry.catalinismith.com/webmention">
  <title>doomfire – Henry Catalini Smith</title>
  <meta name="description" content="Fire animation in pure CSS inspired by the PlayStation version of DOOM.">
  <meta name="og:description" content="Fire animation in pure CSS inspired by the PlayStation version of DOOM.">
  <meta name="og:title" content="doomfire – Henry Catalini Smith">
  <link rel="alternate" type="application/rss+xml" href="https://henry.catalinismith.com/feed.xml">
  <link rel="canonical" href="https://henry.catalinismith.com/2020/12/01/doomfire/">
  <link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="stylesheet" href="/styles/tailwind.css">
 </head>
 <body class="flex h-full bg-zinc-50 dark:bg-black">
  <div class="flex w-full">
   <div class="fixed inset-0 flex justify-center sm:px-8">
    <div class="flex w-full max-w-7xl lg:px-8">
     <div class="w-full bg-white ring-1 ring-zinc-100 dark:bg-zinc-900 dark:ring-zinc-300/20"></div>
    </div>
   </div>
   <div class="relative flex w-full flex-col">
    <header class="pointer-events-none relative z-50 flex flex-none flex-col" style="height:var(--header-height);margin-bottom:var(--header-mb)">
     <div class="top-0 z-10 h-16 pt-6" style="position:var(--header-position)">
      <div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full" style="position:var(--header-inner-position)">
       <div class="mx-auto w-full max-w-7xl lg:px-8">
        <div class="relative px-4 sm:px-8 lg:px-12">
         <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <div class="relative flex gap-4">
           <div class="flex flex-1">
            <div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10"><a aria-label="Home" class="pointer-events-auto" href="/"><img alt="" fetchpriority="high" width="374" height="374" decoding="async" data-nimg="1" class="rounded-full bg-zinc-100 object-cover dark:bg-zinc-800 h-9 w-9" sizes="2.25rem" src="/2023/02/25/malmo-live-2@128x128.jpg" style="color: transparent;"></a></div>
           </div>
           <div class="flex flex-1 justify-end md:justify-center">
            <div class="pointer-events-auto md:hidden"><button class="group flex items-center rounded-full bg-white/90 px-4 py-2 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10 dark:hover:ring-white/20" type="button" aria-expanded="false">Menu
<svg viewBox="0 0 8 6" aria-hidden="true" class="ml-3 h-auto w-2 stroke-zinc-500 group-hover:stroke-zinc-700 dark:group-hover:stroke-zinc-400">
               <path d="M1.75 1.75 4 4.25l2.25-2.5" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg></button>
             <dialog>
              <div class="fixed inset-0 z-50 bg-zinc-800/40 backdrop-blur-sm dark:bg-black/80" aria-hidden="true"></div>
              <div class="fixed inset-x-4 top-8 z-50 origin-top rounded-3xl bg-white p-8 ring-1 ring-zinc-900/5 dark:bg-zinc-900 dark:ring-zinc-800" tabindex="-1">
               <div class="flex flex-row-reverse items-center justify-between"><button aria-label="Close menu" class="-m-1 p-1" type="button"><svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 text-zinc-500 dark:text-zinc-300">
                  <path d="m17.25 6.75-10.5 10.5M6.75 6.75l10.5 10.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                 </svg></button>
                <h2 class="text-sm font-medium text-zinc-600 dark:text-zinc-300">Navigation</h2>
               </div>
               <nav class="mt-6">
                <ul class="-my-2 divide-y divide-zinc-100 text-base text-zinc-800 dark:divide-zinc-100/5 dark:text-zinc-300">
                 <li><a class="block py-2" href="/about">About</a></li>
                 <li><a class="block py-2" href="https://henry.catalinismith.se/">Writing</a></li>
                 <li><a class="block py-2" href="/projects">Projects</a></li>
                 <li><a class="block py-2" href="/gallery">Gallery</a></li>
                 <li><a class="block py-2" href="/speaking">Speaking</a></li>
                </ul>
               </nav>
              </div>
             </dialog>
            </div>
            <script>
                          document.addEventListener("DOMContentLoaded", () => {
                            const menuButton = document.querySelector("button[aria-expanded]");
                            const closeButton = document.querySelector("button[aria-label='Close menu']");
                            const dialog = document.querySelector("dialog");
                            let listener

                            function openMenu() {
                              menuButton.ariaExpanded = "true";
                              dialog.showModal();
                              listener = document.addEventListener("keypress", (event) =>
                                event.key === "Escape" && closeMenu()
                              );
                            }

                            function closeMenu() {
                              menuButton.ariaExpanded = "false";
                              dialog.close();
                              document.removeEventListener("keypress", listener);
                            }

                            menuButton.addEventListener("click", () => openMenu())
                            closeButton.addEventListener("click", () => closeMenu())
                          })
                        </script>
            <div style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div>
            <nav class="pointer-events-auto hidden md:block">
             <ul class="flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10">
              <li><a class="relative block px-3 py-2 transition hover:text-sky-300 hover:underline" href="/about/">About</a></li>
              <li><a class="relative block px-3 py-2 transition hover:text-sky-300 hover:underline" href="/writing/">Writing</a></li>
              <li><a class="relative block px-3 py-2 transition hover:text-sky-300 hover:underline" href="/projects/">Projects</a></li>
              <li><a class="relative block px-3 py-2 transition hover:text-sky-300 hover:underline" href="/gallery/">Gallery</a></li>
              <li><a class="relative block px-3 py-2 transition hover:text-sky-300 hover:underline" href="/speaking/">Speaking</a></li>
             </ul>
            </nav>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </header>
    <script>
    window.location.replace(
      window.location.href.replace(
        "henry.catalinismith.com",
        "henry.catalinismith.se"
      )
    )
  </script>
    <main class="flex-auto">
     <div class="mt-16 sm:px-8 lg:mt-32">
      <div class="mx-auto w-full max-w-7xl lg:px-8">
       <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
         <div class="xl:relative">
          <article>
           <header class="flex flex-col mx-auto flex max-w-2xl flex-col">
            <h1 class="mt-6 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl" lang="">doomfire</h1><time datetime="Tue Dec 01 2020 00:00:00 GMT+0000 (Coordinated Universal Time)" class="order-first flex items-center text-base text-zinc-400 dark:text-zinc-400"><span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span><span class="ml-3">December 1, 2020</span></time>
           </header>
           <video controls preload="none" class="mt-4 max-h-screen w-full object-cover aspect-square max-w-2xl mx-auto" poster="/2020/12/01/doomfire-demo-poster@512x512.png">
            <source src="/2020/12/01/doomfire-demo@512x512.mp4" type="video/mp4">
           </video>
           <div class="prose mt-8 dark:prose-invert mx-auto mt-8 max-w-2xl">
            <p>Fire animation in pure CSS inspired by the PlayStation version of DOOM.</p>
            <iframe height="300" style="width: 100%" scrolling="no" title="doomfire" src="https://codepen.io/henrycatalinismith/embed/preview/jOrraKw?default-tab=css%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen>
             See the Pen &#x3C;a href="https://codepen.io/henrycatalinismith/pen/jOrraKw">
             doomfire&#x3C;/a> by Henry Catalini Smith (&#x3C;a href="https://codepen.io/henrycatalinismith">@henrycatalinismith&#x3C;/a>)
             on &#x3C;a href="https://codepen.io">CodePen&#x3C;/a>.
            </iframe>
            <h2>How This Works</h2>
            <p>The algorithm for the fire itself is from Fabien Sanglard's <a href="https://fabiensanglard.net/doom_fire_psx/">How DOOM fire was done</a>. Fabien's write-up was so helpful that it inspired me to try and pay it forward by explaining how my implementation works. So here goes!</p>
            <h3>Pure CSS</h3>
            <p>It's quite common for CSS animation demos like these to include a bunch of placeholder HTML elements. Typically it'll be like a bunch of <code>&#x3C;div></code> elements for the CSS to animate.</p>
            <p>This one doesn't have any of that, which is what I mean when I call it a "pure CSS" implementation. There's no HTML involved except for the bare minimum required to deliver the CSS in a valid way. What this means is that at its very core, the whole animation piggybacks off a pseudo element on the <code>&#x3C;body></code> tag.</p>
            <h3>One square, one frame</h3>
            <p>We need one static black square as a starting point.</p>
            <pre class="css">body::after {
  background: black;
  content: "";
  position: absolute;
  width: 128px;
  height: 128px;
}
</pre>
            <figure>
             <img alt="White square with a black square in the top left." src="/2020/12/01/doomfire-example-output-1@256x256.png">
             <figcaption>The black square is the <code>::after</code> pseudo-element.</figcaption>
            </figure>
            <p>The black square is the <code>::after</code> pseudo-element.</p>
            <h3>Two squares, one frame</h3>
            <p>The next step is to turn that 1x1 black square into a whole 2D screen, and the magic words for that is box-shadow. In most everyday web development, box shadows are blurry and obscured by the element they belong to. To use them for this kind of magic, there are three rules:</p>
            <ol>
             <li>Hide the element itself: no background color.</li>
             <li>Position them so that they're completely outside the element.</li>
             <li>Don't set a blur radius.</li>
            </ol>
            <p>So here's an updated example using the above technique to increase the resolution from 1x1 to 1x2.</p>
            <pre class="css">body::after {
  content: "";
  position: absolute;
  width: 128px;
  height: 128px;
  box-shadow:
    128px calc(128px * 0) yellow,
    128px calc(128px * 1) red;
}
</pre>
            <figure>
             <img alt="White square with a yellow square in the top right and a red one in the bottom right." src="/2020/12/01/doomfire-example-output-2@256x256.png">
             <figcaption>The yellow square is drawn by the first <code>box-shadow</code> and the red square is drawn by the second one.</figcaption>
            </figure>
            <p>The yellow square is drawn by the first <code>box-shadow</code> and the red square is drawn by the second one.</p>
            <h3>Two squares, three frames</h3>
            <p>From here, increasing the resolution beyond 1x2 is a matter of adding more box shadows to the list. And making them update to look like a fire is a keyframe animation.</p>
            <pre class="css">@keyframes fire {
  33% {
    box-shadow:
      128px calc(128px * 0) white,
      128px calc(128px * 1) white;
  }
  66% {
    box-shadow:
      128px calc(128px * 0) white,
      128px calc(128px * 1) red;
  }
  99% {
    box-shadow:
      128px calc(128px * 0) yellow,
      128px calc(128px * 1) red;
  }
}
</pre>
            <figure>
             <img alt="White square with a black square in the top left." src="/2020/12/01/doomfire-example-output-1@256x256.png">
             <figcaption>The black square is the <code>::after</code> pseudo-element.</figcaption>
            </figure>
            <p>Now it's starting to look like a fire.</p>
            <h3>Performance trade-offs</h3>
            <p>One of the downsides of this technique is how inefficient it is. Box shadows don't animate efficiently even at small scale and this takes them to an extreme. On the bright side, the heating effect this fire animation has on your CPU adds an extra level of immersion and realism to the experience.</p>
            <p>And because every pixel in every frame of the animation needs to be declared explicitly, this is a bandwidth hog too. This 16 second animation is 3.5 megabytes of CSS! Rather than have it cut out abruptly after 16 seconds, I've made it loop infinitely. And fortunately enough, the loop is really seamless. But to make it loop, I've had to cut the part at the beginning where the fire spreads in from the bottom, which is a shame.</p>
            <p>It's not all downsides though. The original DOOM implementation has a real videogame look to it, and the reason this implementation looks a bit more like real flames is thanks to CSS. While the example code above uses a square pseudo element, the real animation uses a long thin one. This stretches the flames out a bit vertically, without changing anything about the algorithm powering it. Combined with the blur filter, I think it produces a pretty neat effect!</p>
           </div>
          </article>
         </div>
        </div>
       </div>
      </div>
     </div>
    </main>
    <script type="module" async>import mermaid from "https://unpkg.com/mermaid@10/dist/mermaid.esm.min.mjs";document.addEventListener('DOMContentLoaded', mermaid.initialize({"loadOnSave":true}));</script>
    <footer class="mt-32 flex-none">
     <div class="sm:px-8">
      <div class="mx-auto w-full max-w-7xl lg:px-8">
       <div class="border-t border-zinc-100 pb-16 pt-10 dark:border-zinc-700/40">
        <div class="relative px-4 sm:px-8 lg:px-12">
         <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <div class="flex flex-col items-center justify-between gap-6 sm:flex-row">
           <div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-sky-500 dark:hover:text-sky-400" href="/about">About
</a><a class="transition hover:text-sky-500 dark:hover:text-sky-400" href="/projects">Projects
</a><a class="transition hover:text-sky-500 dark:hover:text-sky-400" href="/speaking">Speaking</a></div>
           <p class="text-sm text-zinc-500 dark:text-zinc-400">
            ©
            <!-- -->2024<!-- -->
            Henry Catalini Smith. All rights reserved.
           </p>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </footer>
   </div>
  </div>
 </body>
</html>
